---
import PrivateHeader from '../../../components/manage/PrivateHeader.astro'
import SpeciesTable from '../../../components/manage/SpeciesTable.tsx'
import Layout from '../../../layouts/Layout.astro'
import { canAccessRoute, canDelete, type Role } from '../../../lib/utils/permissions'

const user = Astro.locals.user
if (!user) {
  return Astro.redirect('/sign-in')
}

if (!canAccessRoute(user.role as Role, Astro.url.pathname)) {
  return Astro.redirect('/unauthorized')
}

const userCanDelete = canDelete(user.role as Role)
// const stats = await ManageSpeciesRepository.getStats()
---

<Layout title="Gestión de Especies - Panel de Administración">
  <PrivateHeader slot="header" />
  <div class="h-[calc(100vh-112px)] overflow-hidden">
    <SpeciesTable client:load canDelete={userCanDelete} />
  </div>
</Layout>
